import Redis from "ioredis";
{{#if ts}}import { CacheProvider } from "../cache.interface";{{/if}}

export class RedisCacheProvider {{#if ts}} implements CacheProvider {{/if}} {
  private client: Redis;

  constructor(url: string) {
    this.client = new Redis(url, {
      enableReadyCheck: true,
      maxRetriesPerRequest: null
    });

    this.client.on("error", (err) => {
      console.error("[Redis] Error:", err);
    });
  }

  async get{{#if ts}}<T>(key: string){{else}}(key){{/if}} {
    const val = await this.client.get(key);
    return val ? JSON.parse(val) : null;
  }

  async set{{#if ts}}<T>(key: string, value: T, ttl?: number){{else}}(key, value, ttl){{/if}} {
    const str = JSON.stringify(value);

    if (ttl) {
      await this.client.set(key, str, "EX", ttl);
    } else {
      await this.client.set(key, str);
    }
  }

  async del{{#if ts}}(key: string){{else}}(key){{/if}} {
    await this.client.del(key);
  }
}
