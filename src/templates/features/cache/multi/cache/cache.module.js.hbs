{{#if ts}}import { CacheProvider } from "./cache.interface";{{/if}}
import { NodeCacheProvider } from "./providers/node-cache.provider{{#if js}}.js{{/if}}";
import { RedisCacheProvider } from "./providers/redis.provider{{#if js}}.js{{/if}}";
import { MultiTierCacheProvider } from "./providers/multi-tier.provider{{#if js}}.js{{/if}}";
import { env } from "{{#if ts}}@/common/config/env{{else}}../../common/config/env.js{{/if}}";

export function createCacheProvider(){{#if ts}}: CacheProvider{{/if}} {
  const driver = env.CACHE_DRIVER ?? "memory";
  const ttl = Number(env.CACHE_TTL ?? 3600);

  switch (driver) {
    case "redis":
      return new RedisCacheProvider(env.REDIS_URL!);

    case "multi":
      const l1 = new NodeCacheProvider(ttl);
      const l2 = new RedisCacheProvider(env.REDIS_URL!);
      return new MultiTierCacheProvider(l1, l2, ttl);

    case "memory":
    default:
      return new NodeCacheProvider(ttl);
  }
}

export const cacheProvider = createCacheProvider();
