import { eq } from "drizzle-orm";
{{#if ts}}
import db  from "@/common/config/db/index";
import { users } from "@/features/user/user.schema";
import { hashPassword } from "@/utils/password";
{{else}}
import db from "../common/config/db/index.js";
import { users } from "../features/user/user.schema.js";
import { hashPassword } from "../utils/password.js";
{{/if}}

async function run() {
  const globalPassword = "ChangeMeNow!123";
  const userEmail = "user@app.local";

  const existingUser = await db
    .select()
    .from(UserTable)
    .where(eq(UserTable.email, userEmail));

  if (existingUser.length === 0) {
    const passwordHash = await hashPassword(globalPassword);

    await db.insert(UserTable).values({
      email: userEmail,
      password: passwordHash,
      username: "defaultuser",
    });

    console.log("Seeded USER:", userEmail, "password:", globalPassword);
  } else {
    console.log(
      "USER already exists with credentials:",
      userEmail,
      "password:",
      globalPassword
    );
  }
}

run().catch((e) => {
  console.error(e);
  process.exit(1);
});
