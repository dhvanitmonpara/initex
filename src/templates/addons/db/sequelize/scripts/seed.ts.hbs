import { sequelize } from "../src/infra/db/index";
import User from "../src/infra/db/models/user.model";
import { hashPassword } from "../src/lib/crypto";

async function run() {
  const globalPassword = "ChangeMeNow!123";
  const userEmail = "user@app.local";

  // Make sure DB is connected
  await sequelize.authenticate();

  const existingUser = await User.findOne({
    where: { email: userEmail },
  });

  if (!existingUser) {
    const passwordHash = await hashPassword(globalPassword);

    await User.create({
      email: userEmail,
      password: passwordHash,
      username: "defaultuser",
    });

    console.log("Seeded USER:", userEmail, "password:", globalPassword);
  } else {
    console.log(
      "USER already exists with credentials:",
      userEmail,
      "password:",
      globalPassword
    );
  }

  await sequelize.close();
}

run().catch((e) => {
  console.error(e);
  process.exit(1);
});
